<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starfield Particle System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
        }

        canvas {
            display: block;
            background: #0a0015;
            width: 100%;
            height: calc(100vh - 100px);
            position: absolute;
            top: 0;
            left: 0;
        }

        .controls {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.95);
            padding: 15px 20px;
            border-top: 2px solid #ff00ff;
            box-shadow: 0 -5px 20px rgba(255, 0, 255, 0.3);
            display: flex;
            gap: 25px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            z-index: 1000;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            min-width: 150px;
        }

        .control-group label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 12px;
            color: #fff;
            white-space: nowrap;
        }

        .control-group input[type="range"] {
            width: 150px;
            height: 6px;
            border-radius: 3px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
        }

        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            cursor: pointer;
            box-shadow: 0 0 10px #ff00ff;
        }

        .control-group input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px #ff00ff;
        }

        .value-display {
            color: #00ffff;
            font-weight: bold;
            text-shadow: 0 0 10px #00ffff;
            margin-left: 10px;
        }

        h1 {
            font-size: 16px;
            text-align: center;
            background: linear-gradient(90deg, #ff00ff, #00ffff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbow 3s linear infinite;
            background-size: 200% 100%;
            width: 100%;
            margin: 0 0 10px 0;
        }

        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            100% { background-position: 200% 50%; }
        }

        .toggle-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #333;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, #ff00ff, #00ffff);
            box-shadow: 0 0 15px rgba(255, 0, 255, 0.5);
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(26px);
        }

        .toggle-label {
            font-size: 12px;
            color: #fff;
        }

        /* Loading Screen Styles */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(45deg, #0a0015, #1a0030, #0a0015);
            background-size: 400% 400%;
            animation: gradientShift 3s ease infinite;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }

        #loading-screen.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .loading-title {
            font-size: 48px;
            font-weight: bold;
            background: linear-gradient(90deg, #ff00ff, #00ffff, #ff00ff, #00ffff);
            background-size: 300% 100%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: rainbowFlow 2s linear infinite;
            margin-bottom: 40px;
            text-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
        }

        @keyframes rainbowFlow {
            0% { background-position: 0% 50%; }
            100% { background-position: 300% 50%; }
        }

        .loading-spinner {
            width: 120px;
            height: 120px;
            position: relative;
            margin-bottom: 30px;
        }

        .spinner-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid transparent;
            animation: spin 2s linear infinite;
        }

        .spinner-ring:nth-child(1) {
            border-top-color: #ff00ff;
            border-right-color: #ff00ff;
            animation-duration: 1.5s;
        }

        .spinner-ring:nth-child(2) {
            border-bottom-color: #00ffff;
            border-left-color: #00ffff;
            animation-duration: 2s;
            animation-direction: reverse;
        }

        .spinner-ring:nth-child(3) {
            border-top-color: #ff0080;
            border-left-color: #ff0080;
            animation-duration: 2.5s;
            width: 80%;
            height: 80%;
            top: 10%;
            left: 10%;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 20px;
            color: #fff;
            margin-bottom: 20px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .loading-bar-container {
            width: 300px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);
        }

        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff00ff, #00ffff, #ff00ff);
            background-size: 200% 100%;
            animation: loadingBarAnimation 2s ease-in-out;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.8);
        }

        @keyframes loadingBarAnimation {
            0% {
                width: 0%;
                background-position: 0% 50%;
            }
            100% {
                width: 100%;
                background-position: 200% 50%;
            }
        }

        .loading-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: floatParticle 3s ease-in-out infinite;
        }

        @keyframes floatParticle {
            0%, 100% { transform: translateY(0) scale(1); opacity: 0; }
            50% { transform: translateY(-100px) scale(1.5); opacity: 1; }
        }

        /* Theme Preset Buttons */
        .theme-presets {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .theme-btn {
            padding: 10px 20px;
            border: 2px solid;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .theme-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px currentColor;
        }

        .theme-btn.active {
            box-shadow: 0 0 30px currentColor, inset 0 0 10px currentColor;
        }

        #theme-rave {
            color: #ff00ff;
            border-color: #ff00ff;
        }

        #theme-cyberpunk {
            color: #00ffff;
            border-color: #00ffff;
        }

        #theme-sunset {
            color: #ff6b35;
            border-color: #ff6b35;
        }

        #theme-ocean {
            color: #00d4ff;
            border-color: #00d4ff;
        }

        #theme-matrix {
            color: #00ff41;
            border-color: #00ff41;
        }

        #theme-fire {
            color: #ff4500;
            border-color: #ff4500;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loading-particles" id="particles"></div>
        <div class="loading-title">STARFIELD</div>
        <div class="loading-spinner">
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
            <div class="spinner-ring"></div>
        </div>
        <div class="loading-text">Initializing Rave Mode...</div>
        <div class="loading-bar-container">
            <div class="loading-bar"></div>
        </div>
    </div>

    <canvas id="starfield"></canvas>

    <!-- Theme Preset Buttons -->
    <div class="theme-presets">
        <button class="theme-btn active" id="theme-rave">Rave</button>
        <button class="theme-btn" id="theme-cyberpunk">Cyberpunk</button>
        <button class="theme-btn" id="theme-sunset">Sunset</button>
        <button class="theme-btn" id="theme-ocean">Ocean</button>
        <button class="theme-btn" id="theme-matrix">Matrix</button>
        <button class="theme-btn" id="theme-fire">Fire</button>
    </div>

    <div class="controls">
        <div class="control-group">
            <label>
                Star Count<span class="value-display" id="countValue">200</span>
            </label>
            <input type="range" id="starCount" min="50" max="500" value="200" step="10">
        </div>

        <div class="control-group">
            <label>
                Speed<span class="value-display" id="speedValue">2</span>
            </label>
            <input type="range" id="speed" min="0.5" max="10" value="2" step="0.5">
        </div>

        <div class="control-group">
            <label>
                Trail Length<span class="value-display" id="trailValue">5</span>
            </label>
            <input type="range" id="trailLength" min="1" max="15" value="5" step="1">
        </div>

        <div class="control-group">
            <label>
                Star Size<span class="value-display" id="sizeValue">2</span>
            </label>
            <input type="range" id="starSize" min="1" max="5" value="2" step="0.5">
        </div>

        <div class="control-group">
            <label>
                Spread<span class="value-display" id="spreadValue">1</span>
            </label>
            <input type="range" id="spread" min="0.5" max="3" value="1" step="0.1">
        </div>

        <div class="control-group">
            <label>
                Bloom<span class="value-display" id="bloomValue">3</span>
            </label>
            <input type="range" id="bloomIntensity" min="1" max="8" value="3" step="0.5">
        </div>

        <div class="toggle-group">
            <span class="toggle-label">Kaleidoscope</span>
            <div class="toggle-switch" id="kaleidoscopeToggle">
                <div class="toggle-slider"></div>
            </div>
        </div>

        <div class="toggle-group">
            <span class="toggle-label">Chromatic</span>
            <div class="toggle-switch" id="chromaticToggle">
                <div class="toggle-slider"></div>
            </div>
        </div>

        <div class="toggle-group">
            <span class="toggle-label">Mouse Reactive</span>
            <div class="toggle-switch" id="mouseToggle">
                <div class="toggle-slider"></div>
            </div>
        </div>

        <div class="toggle-group">
            <span class="toggle-label">Rotation</span>
            <div class="toggle-switch" id="rotationToggle">
                <div class="toggle-slider"></div>
            </div>
        </div>
    </div>

    <script>
        // Loading Screen Animation
        const loadingScreen = document.getElementById('loading-screen');
        const particlesContainer = document.getElementById('particles');

        // Create floating particles for loading screen
        function createLoadingParticles() {
            const colors = ['#ff00ff', '#00ffff', '#ff0080', '#80ff00'];
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.bottom = '0';
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                particle.style.boxShadow = `0 0 10px ${colors[Math.floor(Math.random() * colors.length)]}`;
                particle.style.animationDelay = Math.random() * 2 + 's';
                particle.style.animationDuration = (Math.random() * 2 + 2) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        createLoadingParticles();

        // Hide loading screen after 2 seconds
        setTimeout(() => {
            loadingScreen.classList.add('fade-out');
            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 500);
        }, 2000);

        const canvas = document.getElementById('starfield');
        const ctx = canvas.getContext('2d');

        // Set canvas size
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Configuration
        let config = {
            starCount: 200,
            speed: 2,
            trailLength: 5,
            starSize: 2,
            spread: 1,
            kaleidoscope: false,
            chromaticAberration: false,
            mouseReactive: false,
            rotation: false,
            bloomIntensity: 3,
            theme: 'rave'
        };

        // Theme color configurations
        const themes = {
            rave: {
                hueShift: 2,
                saturation: 100,
                lightness: 60,
                background: '#0a0015',
                useRainbow: true
            },
            cyberpunk: {
                hueShift: 0,
                saturation: 100,
                lightness: 50,
                background: '#0d0221',
                colors: [180, 300, 320], // Cyan, magenta, pink
                useRainbow: false
            },
            sunset: {
                hueShift: 0,
                saturation: 100,
                lightness: 60,
                background: '#1a0a0a',
                colors: [0, 15, 30, 45], // Red, orange, yellow
                useRainbow: false
            },
            ocean: {
                hueShift: 0,
                saturation: 90,
                lightness: 55,
                background: '#001a33',
                colors: [180, 190, 200, 210, 220], // Blue-cyan range
                useRainbow: false
            },
            matrix: {
                hueShift: 0,
                saturation: 100,
                lightness: 50,
                background: '#000000',
                colors: [120, 130, 140], // Green range
                useRainbow: false
            },
            fire: {
                hueShift: 0,
                saturation: 100,
                lightness: 60,
                background: '#0a0000',
                colors: [0, 10, 20, 30, 40, 50], // Red to yellow
                useRainbow: false
            }
        };

        // Rotation angle
        let rotationAngle = 0;

        // Mouse tracking
        let mouse = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            targetX: canvas.width / 2,
            targetY: canvas.height / 2
        };

        // Helper function to draw star shape
        function drawStar(cx, cy, spikes, outerRadius, innerRadius) {
            let rot = Math.PI / 2 * 3;
            let x = cx;
            let y = cy;
            const step = Math.PI / spikes;

            ctx.beginPath();
            ctx.moveTo(cx, cy - outerRadius);

            for (let i = 0; i < spikes; i++) {
                x = cx + Math.cos(rot) * outerRadius;
                y = cy + Math.sin(rot) * outerRadius;
                ctx.lineTo(x, y);
                rot += step;

                x = cx + Math.cos(rot) * innerRadius;
                y = cy + Math.sin(rot) * innerRadius;
                ctx.lineTo(x, y);
                rot += step;
            }

            ctx.lineTo(cx, cy - outerRadius);
            ctx.closePath();
        }

        // Background Particle class - slow drifting ambient particles
        class BackgroundParticle {
            constructor() {
                this.reset();
            }

            reset() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.vx = (Math.random() - 0.5) * 0.3;
                this.vy = (Math.random() - 0.5) * 0.3;
                this.hue = Math.random() * 360;
                this.size = Math.random() * 1.5 + 0.5;
                this.opacity = Math.random() * 0.3 + 0.1;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.hue = (this.hue + 0.5) % 360;

                if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) {
                    this.reset();
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = `hsla(${this.hue}, 100%, 60%, ${this.opacity})`;
                ctx.fill();
            }
        }

        // Star class
        class Star {
            constructor() {
                this.hue = Math.random() * 360; // Random starting hue for each star
                this.colorIndex = Math.floor(Math.random() * 10); // For non-rainbow themes
                this.reset();
            }

            reset() {
                this.x = Math.random() * canvas.width - canvas.width / 2;
                this.y = Math.random() * canvas.height - canvas.height / 2;
                this.z = Math.random() * canvas.width;
                this.prevX = this.x;
                this.prevY = this.y;

                const currentTheme = themes[config.theme];
                if (currentTheme.useRainbow) {
                    this.hue = Math.random() * 360;
                } else {
                    this.colorIndex = Math.floor(Math.random() * currentTheme.colors.length);
                    this.hue = currentTheme.colors[this.colorIndex];
                }
            }

            update() {
                this.prevX = this.x;
                this.prevY = this.y;

                this.z -= config.speed;

                const currentTheme = themes[config.theme];

                // Update color based on theme
                if (currentTheme.useRainbow) {
                    this.hue = (this.hue + currentTheme.hueShift) % 360;
                } else {
                    // Slowly shift between theme colors
                    this.hue = (this.hue + 0.1) % 360;
                    if (Math.abs(this.hue - currentTheme.colors[this.colorIndex]) > 5) {
                        this.hue = currentTheme.colors[this.colorIndex];
                    }
                }

                if (this.z <= 0) {
                    this.reset();
                }
            }

            draw() {
                // Calculate screen position
                let x = (this.x / this.z) * canvas.width * config.spread;
                let y = (this.y / this.z) * canvas.height * config.spread;

                // Apply rotation if enabled
                if (config.rotation) {
                    const distance = Math.sqrt(x * x + y * y);
                    const angle = Math.atan2(y, x) + rotationAngle;
                    x = Math.cos(angle) * distance;
                    y = Math.sin(angle) * distance;
                }

                // Center the position
                x += canvas.width / 2;
                y += canvas.height / 2;

                // Mouse reactive effect - warp stars towards mouse
                if (config.mouseReactive) {
                    const dx = mouse.x - x;
                    const dy = mouse.y - y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    const maxDistance = 300;

                    if (distance < maxDistance) {
                        const force = (1 - distance / maxDistance) * 50;
                        x += (dx / distance) * force * (1 - this.z / canvas.width);
                        y += (dy / distance) * force * (1 - this.z / canvas.width);
                    }
                }

                const prevX = (this.prevX / (this.z + config.speed)) * canvas.width * config.spread + canvas.width / 2;
                const prevY = (this.prevY / (this.z + config.speed)) * canvas.height * config.spread + canvas.height / 2;

                // Calculate star properties based on depth
                const size = (1 - this.z / canvas.width) * config.starSize;
                const opacity = 1 - this.z / canvas.width;

                // Get theme colors
                const currentTheme = themes[config.theme];
                const saturation = currentTheme.saturation;
                const lightness = currentTheme.lightness;

                if (config.chromaticAberration) {
                    // Draw chromatic aberration effect (RGB split)
                    const offset = size * 1.5;

                    // Red channel
                    drawStar(x - offset, y, 5, size * 1.5, size * 0.6);
                    ctx.fillStyle = `rgba(255, 0, 100, ${opacity * 0.7})`;
                    ctx.fill();

                    // Green channel (main color)
                    drawStar(x, y, 5, size * 1.5, size * 0.6);
                    ctx.fillStyle = `hsla(${this.hue}, ${saturation}%, ${lightness}%, ${opacity})`;
                    ctx.fill();

                    // Blue channel
                    drawStar(x + offset, y, 5, size * 1.5, size * 0.6);
                    ctx.fillStyle = `rgba(0, 200, 255, ${opacity * 0.7})`;
                    ctx.fill();

                    // Trail with RGB split
                    ctx.beginPath();
                    ctx.moveTo(prevX - offset, prevY);
                    ctx.lineTo(x - offset, y);
                    ctx.strokeStyle = `rgba(255, 0, 100, ${opacity * 0.4})`;
                    ctx.lineWidth = size * 0.3;
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(prevX + offset, prevY);
                    ctx.lineTo(x + offset, y);
                    ctx.strokeStyle = `rgba(0, 200, 255, ${opacity * 0.4})`;
                    ctx.lineWidth = size * 0.3;
                    ctx.stroke();
                } else {
                    // Draw trail with rainbow color
                    ctx.beginPath();
                    ctx.moveTo(prevX, prevY);
                    ctx.lineTo(x, y);
                    ctx.strokeStyle = `hsla(${this.hue}, ${saturation}%, ${lightness}%, ${opacity * 0.6})`;
                    ctx.lineWidth = size * 0.5;
                    ctx.stroke();

                    // Draw star shape with vibrant color
                    drawStar(x, y, 5, size * 1.5, size * 0.6);
                    ctx.fillStyle = `hsla(${this.hue}, ${saturation}%, ${lightness}%, ${opacity})`;
                    ctx.fill();
                }

                // Add neon glow effect (bloom) for closer stars
                if (opacity > 0.5) {
                    ctx.beginPath();
                    ctx.arc(x, y, size * config.bloomIntensity, 0, Math.PI * 2);
                    const gradient = ctx.createRadialGradient(x, y, 0, x, y, size * config.bloomIntensity);
                    gradient.addColorStop(0, `hsla(${this.hue}, ${saturation}%, ${lightness + 20}%, ${opacity * 0.5})`);
                    gradient.addColorStop(0.5, `hsla(${this.hue}, ${saturation}%, ${lightness}%, ${opacity * 0.2})`);
                    gradient.addColorStop(1, `hsla(${this.hue}, ${saturation}%, ${lightness}%, 0)`);
                    ctx.fillStyle = gradient;
                    ctx.fill();
                }
            }
        }

        // Create stars and background particles arrays
        let stars = [];
        let backgroundParticles = [];

        function initStars() {
            stars = [];
            for (let i = 0; i < config.starCount; i++) {
                stars.push(new Star());
            }
        }

        function initBackgroundParticles() {
            backgroundParticles = [];
            for (let i = 0; i < 50; i++) {
                backgroundParticles.push(new BackgroundParticle());
            }
        }

        // Animation loop
        function animate() {
            // Smooth mouse tracking
            mouse.x += (mouse.targetX - mouse.x) * 0.1;
            mouse.y += (mouse.targetY - mouse.y) * 0.1;

            // Update rotation angle
            if (config.rotation) {
                rotationAngle += 0.005; // Slow rotation speed
            }

            // Create trail effect by drawing semi-transparent black rectangle
            ctx.fillStyle = `rgba(0, 0, 0, ${1 / config.trailLength})`;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Update and draw background particles
            backgroundParticles.forEach(particle => {
                particle.update();
                particle.draw();
            });

            if (config.kaleidoscope) {
                // Save context state
                ctx.save();

                // Draw to quarter canvas first
                const quarterCanvas = document.createElement('canvas');
                quarterCanvas.width = canvas.width / 2;
                quarterCanvas.height = canvas.height / 2;
                const qCtx = quarterCanvas.getContext('2d');

                // Temporarily swap contexts to draw to quarter canvas
                const tempCtx = ctx;
                window.ctx = qCtx;

                // Draw stars to quarter canvas
                stars.forEach(star => {
                    star.update();
                    star.draw();
                });

                // Restore main context
                window.ctx = tempCtx;

                // Draw kaleidoscope pattern (4 quadrants)
                // Top-left (original)
                ctx.drawImage(quarterCanvas, 0, 0);

                // Top-right (horizontal flip)
                ctx.save();
                ctx.translate(canvas.width, 0);
                ctx.scale(-1, 1);
                ctx.drawImage(quarterCanvas, 0, 0);
                ctx.restore();

                // Bottom-left (vertical flip)
                ctx.save();
                ctx.translate(0, canvas.height);
                ctx.scale(1, -1);
                ctx.drawImage(quarterCanvas, 0, 0);
                ctx.restore();

                // Bottom-right (both flips)
                ctx.save();
                ctx.translate(canvas.width, canvas.height);
                ctx.scale(-1, -1);
                ctx.drawImage(quarterCanvas, 0, 0);
                ctx.restore();

                ctx.restore();
            } else {
                // Normal mode - update and draw stars
                stars.forEach(star => {
                    star.update();
                    star.draw();
                });
            }

            requestAnimationFrame(animate);
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            stars.forEach(star => star.reset());
        });

        // Control handlers
        document.getElementById('starCount').addEventListener('input', (e) => {
            config.starCount = parseInt(e.target.value);
            document.getElementById('countValue').textContent = config.starCount;
            initStars();
        });

        document.getElementById('speed').addEventListener('input', (e) => {
            config.speed = parseFloat(e.target.value);
            document.getElementById('speedValue').textContent = config.speed;
        });

        document.getElementById('trailLength').addEventListener('input', (e) => {
            config.trailLength = parseInt(e.target.value);
            document.getElementById('trailValue').textContent = config.trailLength;
        });

        document.getElementById('starSize').addEventListener('input', (e) => {
            config.starSize = parseFloat(e.target.value);
            document.getElementById('sizeValue').textContent = config.starSize;
        });

        document.getElementById('spread').addEventListener('input', (e) => {
            config.spread = parseFloat(e.target.value);
            document.getElementById('spreadValue').textContent = config.spread;
        });

        document.getElementById('bloomIntensity').addEventListener('input', (e) => {
            config.bloomIntensity = parseFloat(e.target.value);
            document.getElementById('bloomValue').textContent = config.bloomIntensity;
        });

        // Kaleidoscope toggle handler
        document.getElementById('kaleidoscopeToggle').addEventListener('click', (e) => {
            config.kaleidoscope = !config.kaleidoscope;
            e.currentTarget.classList.toggle('active');
        });

        // Chromatic aberration toggle handler
        document.getElementById('chromaticToggle').addEventListener('click', (e) => {
            config.chromaticAberration = !config.chromaticAberration;
            e.currentTarget.classList.toggle('active');
        });

        // Mouse reactive toggle handler
        document.getElementById('mouseToggle').addEventListener('click', (e) => {
            config.mouseReactive = !config.mouseReactive;
            e.currentTarget.classList.toggle('active');
        });

        // Rotation toggle handler
        document.getElementById('rotationToggle').addEventListener('click', (e) => {
            config.rotation = !config.rotation;
            e.currentTarget.classList.toggle('active');
        });

        // Theme preset handlers
        function applyTheme(themeName) {
            config.theme = themeName;
            const theme = themes[themeName];

            // Update canvas background
            canvas.style.background = theme.background;

            // Reset all stars to use new theme colors
            stars.forEach(star => star.reset());

            // Update active button state
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`theme-${themeName}`).classList.add('active');
        }

        document.getElementById('theme-rave').addEventListener('click', () => applyTheme('rave'));
        document.getElementById('theme-cyberpunk').addEventListener('click', () => applyTheme('cyberpunk'));
        document.getElementById('theme-sunset').addEventListener('click', () => applyTheme('sunset'));
        document.getElementById('theme-ocean').addEventListener('click', () => applyTheme('ocean'));
        document.getElementById('theme-matrix').addEventListener('click', () => applyTheme('matrix'));
        document.getElementById('theme-fire').addEventListener('click', () => applyTheme('fire'));

        // Mouse movement tracking
        canvas.addEventListener('mousemove', (e) => {
            mouse.targetX = e.clientX;
            mouse.targetY = e.clientY;
        });

        // Touch support for mobile
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            mouse.targetX = touch.clientX;
            mouse.targetY = touch.clientY;
        });

        // Initialize and start animation
        initStars();
        initBackgroundParticles();
        animate();
    </script>
</body>
</html>
